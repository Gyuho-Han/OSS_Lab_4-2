<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Manager</title>
    <style>
      :root {
        --bg: #0b1020;
        --bg-soft: #0f162f;
        --panel: #0f162f;
        --panel-elev: #121a38;
        --accent: #7c9bff;
        --accent-strong: #5f80ff;
        --text: #e7eaf6;
        --muted: #9aa3bf;
        --danger: #ff6b6b;
        --radius: 16px;
      }

      * { box-sizing: border-box; }

      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
        color: var(--text);
        background:
          radial-gradient(1200px 600px at 10% -10%, rgba(124,155,255,0.25), transparent 60%),
          radial-gradient(900px 500px at 110% -10%, rgba(111,76,255,0.25), transparent 60%),
          linear-gradient(180deg, #0b1020 0%, #0b1020 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        padding: 32px 14px;
      }

      body.modal-open { overflow: hidden; }

      .app {
        width: 100%;
        max-width: 1100px;
        background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 22px;
        box-shadow: 0 30px 60px rgba(2, 6, 23, 0.45);
        overflow: hidden;
        margin: 0 auto;
      }

      header {
        position: relative;
        padding: 22px 22px 18px;
        border-bottom: 1px solid rgba(255,255,255,0.06);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        background:
          radial-gradient(800px 300px at -10% 0%, rgba(124,155,255,0.18), transparent 60%),
          linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0));
      }

      .title-wrap h1 {
        margin: 0 0 6px;
        font-size: 1.25rem;
        letter-spacing: 0.2px;
      }
      .title-wrap p {
        margin: 0;
        color: var(--muted);
        font-size: 0.88rem;
      }

      .toolbar {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
      }

      .input {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: var(--panel);
        border: 1px solid rgba(255,255,255,0.06);
        border-radius: 999px;
        padding: 8px 12px;
        color: var(--text);
      }
      .input input {
        border: none;
        outline: none;
        background: transparent;
        color: var(--text);
        min-width: 160px;
      }

      .btn {
        background: var(--accent);
        border: none;
        color: #0b1020;
        padding: 8px 14px;
        border-radius: 9999px;
        font-weight: 700;
        letter-spacing: 0.2px;
        cursor: pointer;
        transition: transform .1s ease, filter .15s ease;
      }
      .btn:hover { filter: brightness(1.05); transform: translateY(-1px); }
      .btn.secondary { background: #2a355f; color: #e6eaff; }
      .btn.ghost { background: rgba(255,255,255,0.06); color: #e6eaff; }

      .body-wrap { display: grid; grid-template-columns: minmax(0, 1fr); }

      /* list panel */
      #contents {
        padding: 18px 18px 26px;
        background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0));
        overflow-y: auto;
        min-height: 480px;
      }

      #contents .empty {
        text-align: center;
        color: var(--muted);
        padding: 80px 10px;
      }
      #contents .empty .emoji { font-size: 2rem; display: block; margin-bottom: 8px; }

      #contents ul {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        gap: 12px;
      }

      #contents li {
        background: linear-gradient(180deg, var(--panel) 0%, var(--panel-elev) 100%);
        border: 1px solid rgba(255,255,255,0.06);
        border-radius: 14px;
        padding: 12px 12px 12px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px 14px;
        align-items: center;
      }

      .avatar {
        width: 36px; height: 36px; border-radius: 50%;
        background: conic-gradient(from 0deg, #7c9bff, #6f4cff, #7c9bff);
        display: inline-flex; align-items: center; justify-content: center;
        color: #fff; font-size: 0.88rem; font-weight: 800;
        box-shadow: inset 0 0 0 2px rgba(255,255,255,0.15);
      }

      .meta { flex: 1 1 260px; min-width: 200px; }
      .meta .name { font-weight: 700; font-size: 0.98rem; }
      .meta .sub { color: var(--muted); font-size: 0.8rem; }

      .badge {
        display: inline-flex; align-items: center; gap: 6px;
        border-radius: 999px; padding: 2px 8px; font-size: 0.72rem; font-weight: 700;
        background: rgba(124,155,255,0.14); color: #c9d4ff; cursor: default; user-select: none;
        margin-left: 8px;
      }
      .badge.male { background: rgba(124,155,255,0.14); color: #c9d4ff; }
      .badge.female { background: rgba(255,145,197,0.16); color: #ffd7ec; }
      .badge.na { background: rgba(156,163,175,0.16); color: #e5e7eb; }

      .row-actions button { margin-left: 8px; }

      #contents button {
        border: 1px solid rgba(255,255,255,0.08);
        background: rgba(255,255,255,0.06);
        padding: 6px 12px;
        border-radius: 999px;
        font-size: 0.74rem;
        color: #e6eaff;
        cursor: pointer;
        transition: 0.12s ease;
      }
      #contents button:hover { background: rgba(255,255,255,0.12); }
      #contents button:last-child { background: rgba(255, 107, 107, 0.12); color: #ffd5d5; border-color: rgba(255, 107, 107, 0.25); }
      #contents button:last-child:hover { background: rgba(255, 107, 107, 0.2); }

      /* modal */
      .modal-overlay {
        position: fixed; inset: 0; background: rgba(2, 6, 23, 0.65);
        display: none; align-items: center; justify-content: center; padding: 16px; z-index: 50;
      }
      .modal {
        background: linear-gradient(180deg, var(--panel) 0%, var(--panel-elev) 100%);
        width: 100%; max-width: 560px; border-radius: 18px;
        box-shadow: 0 30px 60px rgba(2, 6, 23, 0.6);
        border: 1px solid rgba(255,255,255,0.08);
        padding: 18px 18px 20px;
      }
      .modal h2 { font-size: 1rem; margin: 0 0 12px; color: var(--text); }

      .form-grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
      @media (min-width: 520px) { .form-grid { grid-template-columns: 1fr 1fr; } }

      .input-row { display: flex; flex-direction: column; gap: 6px; }
      label { font-size: 0.78rem; color: var(--text); font-weight: 600; }
      input[type="text"] {
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 12px; padding: 10px 12px; font-size: 0.88rem;
        transition: 0.12s ease; outline: none; background: rgba(255,255,255,0.04); color: var(--text);
      }
      input[type="text"]::placeholder { color: #aab3cf; }
      input[type="text"]:focus { border-color: rgba(124,155,255,0.45); box-shadow: 0 0 0 3px rgba(124,155,255,0.12); }

      #btnAdd { width: 100%; background: var(--accent); border: none; border-radius: 12px; padding: 10px 0; font-weight: 800; color: #0b1020; cursor: pointer; margin-top: 8px; transition: 0.12s ease; }
      #btnAdd:hover { filter: brightness(1.06); }
      #btnCancel { width: 100%; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 10px 0; font-weight: 700; color: #e6eaff; cursor: pointer; margin-top: 6px; transition: 0.12s ease; display: none; }
      #btnCancel:hover { background: rgba(255,255,255,0.12); }

      /* responsive */
      @media (max-width: 560px) {
        header { flex-direction: column; align-items: flex-start; gap: 10px; }
        .app { border-radius: 16px; }
        #contents { padding: 14px; }
      }
    </style>
    <script>
      window.onload = function () {
        const btnStu = document.getElementById("btnStu");
        const btnAdd = document.getElementById("btnAdd");
        const btnCancel = document.getElementById("btnCancel");
        const btnOpenModal = document.getElementById("btnOpenModal");
        const overlay = document.getElementById("modalOverlay");
        const search = document.getElementById("search");

        // Keep a copy of data for filtering
        window.stuData = [];

        btnStu.addEventListener("click", getStudents);

        btnOpenModal.addEventListener("click", function () {
          resetForm();
          showModal();
        });

        btnAdd.addEventListener("click", function () {
          if (btnAdd.textContent === "Add") {
            postData();
          } else {
            updateData();
          }
        });
        btnCancel.addEventListener("click", function () {
          hideModal();
          resetForm();
        });

        if (search) {
          search.addEventListener("input", function () {
            const q = search.value.trim().toLowerCase();
            if (!q) return renderList(window.stuData);
            const filtered = window.stuData.filter((s) => {
              return (
                (s.name || "").toLowerCase().includes(q) ||
                String(s.age || "").toLowerCase().includes(q) ||
                (s.email || "").toLowerCase().includes(q) ||
                (s.phone || "").toLowerCase().includes(q) ||
                (s.sex || "").toLowerCase().includes(q)
              );
            });
            renderList(filtered);
          });
        }

        // Close when clicking outside modal content
        overlay.addEventListener("click", function (e) {
          if (e.target === overlay) {
            hideModal();
            resetForm();
          }
        });

        // Auto-fetch on load
        getStudents();
      };

      function showModal() {
        const overlay = document.getElementById("modalOverlay");
        overlay.style.display = "flex";
        document.body.classList.add("modal-open");
      }

      function hideModal() {
        const overlay = document.getElementById("modalOverlay");
        overlay.style.display = "none";
        document.body.classList.remove("modal-open");
      }

      function resetForm() {
        document.getElementById("name").value = "";
        document.getElementById("age").value = "";
        document.getElementById("email").value = "";
        document.getElementById("phone").value = "";
        document.getElementById("sex").value = "";
        document.getElementById("btnAdd").textContent = "Add";
        document.getElementById("btnAdd").removeAttribute("data-id");
        const title = document.getElementById("formTitle");
        if (title) title.textContent = "Add New Student";
      }

      function editData(id, name, age, email, phone, sex) {
        document.getElementById("name").value = name;
        document.getElementById("age").value = age;
        document.getElementById("email").value = email;
        document.getElementById("phone").value = phone;
        document.getElementById("sex").value = sex;
        document.getElementById("btnAdd").textContent = "Update";
        document.getElementById("btnAdd").setAttribute("data-id", id);
        const title = document.getElementById("formTitle");
        if (title) title.textContent = "Edit Student";
        showModal();
      }

      function getStudents() {
        let contents = document.getElementById("contents");
        const xhr = new XMLHttpRequest();

        xhr.onload = () => {
          if (xhr.status === 201 || xhr.status === 200) {
            const res = JSON.parse(xhr.response);
            window.stuData = Array.isArray(res) ? res : [];
            renderList(window.stuData);
          } else {
            console.log(xhr.status, xhr.statusText);
          }
        };

        xhr.open(
          "GET",
          "https://690493406b8dabde496444eb.mockapi.io/my_data"
        );
        xhr.send();
      }

      function renderList(data) {
        let contents = document.getElementById("contents");
        if (!data || data.length === 0) {
          contents.innerHTML = `
            <div class="empty">
              <span class="emoji">âœ¨</span>
              No students yet. Click "Add New Student" to create one, or "Fetch" to load demo data.
            </div>
          `;
          return;
        }
        let str = "<ul>";
        for (let i = 0; i < data.length; i++) {
          const stu = data[i];
          const email = stu.email ? stu.email : "-";
          const phone = stu.phone ? stu.phone : "-";
          const sex = (stu.sex || "-").toLowerCase();
          const badgeClass = sex === "male" ? "male" : sex === "female" ? "female" : "na";
          const initials = (stu.name || "?")
            .split(" ")
            .map((p) => p[0])
            .join("")
            .slice(0, 2)
            .toUpperCase();

          str += `
            <li>
              <div class="avatar" aria-hidden="true">${initials}</div>
              <span class="badge ${badgeClass}">${sex || '-'}</span>
              <div class="meta">
                <div class="name">${escapeHtml(stu.name || "Unnamed")} <span class="sub">(${escapeHtml(stu.age || "-")})</span></div>
                <div class="sub">${escapeHtml(email)} â€¢ ${escapeHtml(phone)}</div>
              </div>
              <div class="row-actions">
                <button onclick="editData('${stu.id}', '${js(stu.name)}', '${js(stu.age)}', '${js(stu.email)}', '${js(stu.phone)}', '${js(stu.sex)}')">Modify</button>
                <button onclick="deleteData('${stu.id}')">Delete</button>
              </div>
            </li>
          `;
        }
        str += "</ul>";
        contents.innerHTML = str;
      }

      // Basic escaping helpers for safe HTML/JS embedding
      function escapeHtml(v) {
        return String(v == null ? "" : v)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }
      function js(v) {
        return String(v == null ? "" : v)
          .replace(/\\/g, "\\\\")
          .replace(/'/g, "\\'")
          .replace(/\n/g, "\\n");
      }

      function postData() {
        let name = document.getElementById("name");
        let age = document.getElementById("age");
        let email = document.getElementById("email");
        let phone = document.getElementById("phone");
        let sex = document.getElementById("sex");

        const xhr = new XMLHttpRequest();

        xhr.onload = () => {
          if (xhr.status === 201 || xhr.status === 200) {
            resetForm();
            hideModal();
            getStudents();
          } else {
            console.log(xhr.status, xhr.statusText);
          }
        };

        xhr.open(
          "POST",
          "https://690493406b8dabde496444eb.mockapi.io/my_data"
        );
        xhr.setRequestHeader("content-type", "application/json; charset=UTF-8");

        const data = {
          name: name.value,
          age: age.value,
          email: email.value,
          phone: phone.value,
          sex: sex.value
        };

        xhr.send(JSON.stringify(data));
      }

      function updateData() {
        let id = document.getElementById("btnAdd").getAttribute("data-id");
        let name = document.getElementById("name");
        let age = document.getElementById("age");
        let email = document.getElementById("email");
        let phone = document.getElementById("phone");
        let sex = document.getElementById("sex");

        const xhr = new XMLHttpRequest();
        xhr.open(
          "PUT",
          "https://690493406b8dabde496444eb.mockapi.io/my_data/" + id
        );
        xhr.setRequestHeader("content-type", "application/json; charset=UTF-8");

        const data = {
          name: name.value,
          age: age.value,
          email: email.value,
          phone: phone.value,
          sex: sex.value
        };
        xhr.send(JSON.stringify(data));

        xhr.onload = () => {
          if (xhr.status === 200) {
            resetForm();
            hideModal();
            getStudents();
          } else {
            console.log(xhr.status, xhr.statusText);
          }
        };
      }

      function deleteData(id) {
        const xhr = new XMLHttpRequest();
        xhr.open(
          "DELETE",
          "https://690493406b8dabde496444eb.mockapi.io/my_data/" + id
        );

        xhr.onload = () => {
          if (xhr.status === 200) {
            getStudents();
          } else {
            console.log(xhr.status, xhr.statusText);
          }
        };
        xhr.send();
      }
    </script>
  </head>

  <body>
    <div class="app">
      <header>
        <div class="title-wrap">
          <h1>ðŸ“š Student Manager</h1>
          <p>Create, Read, Update, Delete and Search</p>
        </div>
        <div class="toolbar">
          <label class="input" for="search">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 0 0-15 7.5 7.5 0 0 0 0 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <input id="search" placeholder="Search students..." />
          </label>
          <button id="btnStu" class="btn ghost" title="Fetch demo data">Fetch</button>
          <button id="btnOpenModal" class="btn" title="Add a new student">Add New Student</button>
        </div>
      </header>
      <div class="body-wrap">
        <div id="contents"></div>
      </div>
    </div>

    <!-- Modal (moved outside .app to cover full viewport) -->
    <div id="modalOverlay" class="modal-overlay">
      <div class="modal">
        <h2 id="formTitle">Add New Student</h2>
        <div class="form-grid">
          <div class="input-row">
            <label for="name">Name</label>
            <input type="text" id="name" placeholder="Jane Doe" />
          </div>
          <div class="input-row">
            <label for="age">Age</label>
            <input type="text" id="age" placeholder="20" />
          </div>
          <div class="input-row">
            <label for="email">Email</label>
            <input type="text" id="email" placeholder="jane@school.edu" />
          </div>
          <div class="input-row">
            <label for="phone">Phone</label>
            <input type="text" id="phone" placeholder="010-0000-0000" />
          </div>
          <div class="input-row" style="grid-column: 1 / -1;">
            <label for="sex">Sex</label>
            <input type="text" id="sex" placeholder="male / female" />
          </div>
        </div>
        <button id="btnAdd" type="button">Add</button>
        <button id="btnCancel" type="button">Cancel</button>
      </div>
    </div>
  </body>
</html>
